<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Outside - Minimalist Ecommerce HTML Template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
    
    <!-- All CSS Files -->
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Icon Font -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/pe-icon-7-stroke.css">
    <!-- Plugins css file -->
    <link rel="stylesheet" href="css/plugins.css">
    <!-- Theme main style -->
    <link rel="stylesheet" href="style.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Modernizr JS -->
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    
</head>

<body>

     



<!-- Body main wrapper start -->
<div class="wrapper">

<!-- START HEADER SECTION -->
<header class="header-section section sticker">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <!-- logo -->
                <div class="header-logo float-left">
                    <a href="index.html">
                    <img src="img/logo.png" alt="main logo">
                    </a>
                </div>
                
                <!-- header-search & total-cart -->
                <div class="float-right">
                    
                    <!-- some button -->
                    <nav class="main-menu menu-right float-right">
                        <ul>
                        	<!-- 跳转主页面 -->
                            <li><a href="index.html">Home</a></li>                       
                            <!-- 跳转购物车页面 -->
							<li><a href="cart.html">cart</a></li>
							<!-- 跳转个人信息主页 -->
							 <li><a href="detail.html">personal</a>
                                <ul class="sub-menu">
                                    <li><a href="detail.html">details</a></li>
                                    <li><a href="order.html">My order</a></li>
                                </ul>
                            </li>
                            <!-- 跳转登录页面 -->
  							<li><a href="login.html">login</a></li>  
                           
                        </ul>
                    </nav>
                </div>
                <div class="mobile-menu"></div>
            </div>
        </div>
    </div>
</header>
<!-- END HEADER SECTION -->

<!-- PAGE BANNER SECTION -->
<div class="page-banner-section section">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div class="page-banner-content">
                    <h1>Cart page</h1>
                    <ul class="breadcrumb">
                        <li><a href="#">Home</a></li>
                        <li class="active">Cart page</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>


 
 
<!-- PAGE SECTION START -->
<div class="page-section section pt-120 pb-80">
    <div class="container">
        <div class="row">
            <form action="#">				
                <div class="col-xs-12">
                    <div class="cart-table table-responsive mb-40">
                        <table id = "cartTable">
                            <thead>
                                <tr>
                                	<th hidden="hidden"> uid</th>
                                    <th class="pro-thumbnail">Image</th>
                                    <th class="pro-title">Product</th>
                                    <th class="pro-price">Price</th>
                                    <th class="pro-quantity">Quantity</th>
                                    <th class="pro-subtotal">Total</th>
                                    <th class="pro-remove">Remove</th>
                                </tr>
                            </thead>
                            <tbody id = "tbody1">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="col-md-12 col-sm-5 col-xs-12">
                    <div class="cart-total mb-40">
                        <h3>Cart Totals</h3>
                        <table>
                            <tbody>
                                <tr class="cart-subtotal">
                                    <th>Subtotal</th>
                                    <td><input  type="text" id = 'total1' value = '0'></td>
                                </tr>
                                <tr class="order-total">
                                    <th>Total</th>
                                    <td>
                                        <strong><input  type="text" id = 'total2' value = '0'></strong>
                                    </td>
                                </tr>											
                            </tbody>
                        </table>
                        <div class="proceed-to-checkout section mt-30">
                            <a href="javascript:void(0)" onclick =createOrder()>Create Order</a>
                        </div>
                    </div>
                </div>
            </form>	
        </div>
    </div>
</div>

<!-- PAGE SECTION END --> 

<!-- FOOTER TOP SECTION START -->
<div class="footer-top-section section pt-100 pb-60">
	<div class="container">
		<div class="row">
            <!-- Footer Widget -->
			<div class="footer-widget text-center col-md-12 col-sm-6 col-xs-12 mb-40">
				<h5 class="widget-title">ABOUT THE STORE</h5>
				<p>You can find many fantastic goods here.However you can get them in no way.
				</p>
			</div>					
		</div>
	</div>
</div>
<!-- FOOTER TOP SECTION END -->  

<!-- FOOTER BOTTOM SECTION START -->
<div class="footer-bottom-section section">
	<div class="container">
		<div class="row">

            	<!-- Copyright -->
				<div class="copyright  col-sm-6 col-xs-12 ">
				<p>Powered by Cytra. Cobbom Ourck.top</p>

			</div>
		</div>
	</div>
</div>
<!-- FOOTER BOTTOM SECTION END -->  
   

</div>
<!-- Body main wrapper end -->


<!-- Placed JS at the end of the document so the pages load faster -->

<!-- jQuery latest version -->
<script src="js/vendor/jquery-3.1.1.min.js"></script>
<!-- Bootstrap js -->
<script src="js/bootstrap.min.js"></script>
<!-- Plugins js -->
<script src="js/plugins.js"></script>
<!-- Ajax Mail js -->
<script src="js/ajax-mail.js"></script>
<!--  this is my js -->
<!--  document.write('');-->
<script>
	function deleteGood(oiid){
		 $.ajax({ 
		     url: "http://localhost:8080/JEEFakeTmall/cart/update?op=delete", 
		     type: 'get',  
		     data: "oiid="+oiid,
		     success: function(data){
	     	        }        	   
		     	 });
	}
	function createOrder(){
		
		var table = document.getElementById("cartTable");
		var rows = table.rows.length;
		var Cartdata ='{';
		
		for(var i = 1; i<rows; i++ ){
			Cartdata += table.rows[i].cells[0].innerHTML;
			Cartdata +=" : "+document.getElementById(i-1).value;
			if(i <rows-1)
				Cartdata += ",";
		}
		
		Cartdata +="}";
		
		Cardata = eval('('+Cartdata+')');
		
		 $.ajax({ 
		     url: "http://localhost:8080/JEEFakeTmall/cart/commit", 
		     type: 'post',  
		     data: Cartdata,
		     success: function(data){
	     	        }        	   
		     	 });
		
	}
</script>
<script>
 
 var goodNum = 0;
 var tableData;
 function createTable(pid,name,img_url,quantity,price){
	 tableData ='<tr>';
	 tableData +='<td hidden="hidden">'+pid+'</td>';
	 tableData +='<td class="pro-thumbnail"><a href="#"><img src="'+ img_url+'" alt="" /></a></td>';
	 tableData +='<td class="pro-title"><a href="#">' + name + '</a></td>';
	 tableData +=' <td class="pro-price"><input type="text" id ="v' + goodNum + '" value="'+ price +'" /></td>';
	 tableData +=' <td class="pro-quantity">';
	 	tableData +='<div class="product-quantity">';
	 		tableData +='<input type="text" id ="' + goodNum + '" value="' + quantity +'" />';
	 		//小箭头
	 		tableData +='<span class="dec qtybtn"><i  class="fa fa-angle-left"></i></span><span class="inc qtybtn"><i class="fa fa-angle-right"></i></span>';
	 	 tableData +='</div>';
	 tableData +='</td>';
	 tableData +='<td class="pro-subtotal"><input type="text" id = "sv' + goodNum 
	 	+ '" value="' + parseInt(quantity)*parseInt(price) +'" /></td>';
	 tableData +='<td class="pro-remove"><a href="javascript:void(0)" onclick =deleteGood('+oiid+')>×</a></td> ';
	 tableData +=' </tr>   ';
	 
	 container = document.getElementById('tbody1');
	 container.innerHTML  += tableData; 
	 goodNum++;
	 
 }
	
 function calSum(){
	   	var SubV = 0;
	   	for(i = 0; i < goodNum; i++)
	   		{
	   			SubV += parseInt(document.getElementById('sv' + i).value);
	   		}
	   	document.getElementById('total1').value = SubV;
	   	document.getElementById('total2').value = SubV;
 }
 
 $(document).ready(function() {  
	 /* createTable('noname','img/product/1.jpg','1','160');
	 createTable('noname','img/product/1.jpg','2','250'); */
	 $.ajax({ 
	     url: "http://localhost:8080/JEEFakeTmall/cart/list", 
	     type: 'get',  
	     success: function(data){
	     	 //data = eval('(' + data + ')')
	     	 for(var num in data){
     	        //表示遍历数组，而i表示的是数组的下标值，
     	        //result[i]表示获得第i个json对象即JSONObject
     	        //result[i]通过.字段名称即可获得指定字段的值
     	        if(data[num].name != ''){     	        	
     	        	createTable(data[num].pid,data[num].name, data[num].oiid,
     	        			data[num].img_url, data[num].quantity,data[num].price);
     	        }        	   
	     	 }
	     	calSum();
	
	     	$('.qtybtn').on('click', function() {
			    var $button = $(this);
			    var oldValue = $button.parent().find('input').val();
			    if ($button.hasClass('inc')) {
			        var newVal = parseFloat(oldValue) + 1;
			    } else {
			        // Don't allow decrementing below zero
			        if (oldValue > 0) {
			            var newVal = parseFloat(oldValue) - 1;
			        } else {
			            newVal = 0;
			        }
			    }
			    $button.parent().find('input').val(newVal);
			    var row = $button.parent().find('input').attr('id');
				var price = document.getElementById('v' + row).value;
			   	document.getElementById('sv' + row).value = newVal * price;
			   	calSum();		   	
			});
	     }              
	 });
	 
	 
}); 
</script>
<!-- Main js -->
<script src="js/main.js"></script>



</body>

</html>
